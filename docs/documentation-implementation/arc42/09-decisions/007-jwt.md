# ADR-007 : JWT Authentication

## Statut

Accepté (2024-12)

## Contexte

SkillSwap nécessite un système d'authentification sécurisé pour identifier les utilisateurs, protéger les routes sensibles et maintenir la session entre les requêtes. L'application est une SPA Next.js communiquant avec une API Express séparée.

## Décision

**JWT (JSON Web Tokens) stockés dans des cookies HTTP-only** plutôt que localStorage ou sessions serveur.

## Alternatives considérées

| Alternative          | Avantages                    | Inconvénients                    |
| -------------------- | ---------------------------- | -------------------------------- |
| JWT en localStorage  | Simple à implémenter         | Vulnérable aux attaques XSS      |
| Sessions serveur     | Révocation instantanée       | Stateful, nécessite Redis        |
| OAuth2 / OIDC        | Standard industrie           | Over-engineering pour un MVP     |

## Conséquences

### Positives

- Stateless : pas de session serveur à gérer
- Sécurisé : cookies HTTP-only protègent contre XSS
- Scalable : n'importe quel serveur peut valider le token

### Négatives

- Révocation complexe (token valide jusqu'à expiration)
- Nécessite HTTPS en production

## Configuration des tokens

| Token          | Durée    | Stockage              | Usage                    |
| -------------- | -------- | --------------------- | ------------------------ |
| `accessToken`  | 15 min   | Cookie HTTP-only      | Authentifier les requêtes|
| `refreshToken` | 7 jours  | Cookie HTTP-only + BDD| Renouveler l'accessToken |

## Flux d'authentification

```mermaid
sequenceDiagram
    participant C as Client
    participant B as Backend
    participant DB as PostgreSQL

    C->>B: POST /auth/login (email, password)
    B->>DB: Vérifier credentials
    DB-->>B: User trouvé
    B->>B: Générer accessToken (15min)
    B->>B: Générer refreshToken (7j)
    B->>DB: Sauvegarder refreshToken
    B-->>C: Set-Cookie: accessToken, refreshToken
```

---

[← Retour à l'index](./index.md)
